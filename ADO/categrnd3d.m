function [ind, cnt] = categrnd(p, si)
    %p2 = reshape(p',numel(p),1);
    %p2 = p';
    p2 = permute(p,[2,1,3]);
    %p2=p;
    p2 = p2(:);
    %size(p2)
    r = rand(1,si);
    %r = [0.647551049353 ,0.507149688213 ,0.528341380152 ,0.89628520401 ,0.699991190667 ,0.714297101871 ,0.717338382091 ,0.222819462183 ,0.175154523324 ,0.456841488338 ,0.928738431539 ,0.00988588704045 ,0.089922194684 ,0.850200267855 ,0.485621058895 ,0.876835591949 ,0.307333938865 ,0.387965546161 ,0.581445742941 ,0.113687180516 ,0.767880184799 ,0.312566039803 ,0.646010459752 ,0.032698916996 ,0.166395576932 ,0.430303032385 ,0.227806470007 ,0.966307466088 ,0.904939408607 ,0.865662913067 ,0.0321627823743 ,0.79949775076 ,0.906155511611 ,0.703933330754 ,0.229712446682 ,0.411435599137 ,0.978643961585 ,0.32904596007 ,0.595529071523 ,0.535846340891 ,0.461095955557 ,0.225799661918 ,0.920552966194 ,0.610822841829 ,0.220091921584 ,0.0392845997556 ,0.547889577734 ,0.0901867171217 ,0.818068280052 ,0.683569581175 ,0.935827990202 ,0.0899110629356 ,0.0133576108219 ,0.216112444186 ,0.383707412954 ,0.737533673826 ,0.255054265802 ,0.255398511103 ,0.238930217869 ,0.106521008878 ,0.182275593341 ,0.892932333216 ,0.0597374006923 ,0.16596351873 ,0.0370124940175 ,0.700853445257 ,0.99664966395 ,0.111027188794 ,0.724557091285 ,0.337413392607 ,0.176827650737 ,0.941867877392 ,0.975934489677 ,0.764765858063 ,0.402545016341 ,0.418011770042 ,0.644977475392 ,0.035683973193 ,0.134681454471 ,0.634774743909 ,0.930551112505 ,0.95042256106 ,0.563339716551 ,0.212031120219 ,0.540922050963 ,0.173333237629 ,0.14749908542 ,0.726495034018 ,0.20976829256 ,0.0220900754219 ,0.625968434921 ,0.95093251856 ,0.893599581288 ,0.369263660267 ,0.928686472663 ,0.514880714188 ,0.943710205214 ,0.569471093134 ,0.0132989346425 ,0.338276842289 ,0.118645354612 ,0.340629158629 ,0.364019010694 ,0.65473561023 ,0.936002433332 ,0.199474788975 ,0.623801055563 ,0.157172085836 ,0.0825612522631 ,0.693097140817 ,0.273711169641 ,0.404922745701 ,0.997174857495 ,0.504111199745 ,0.938028855994 ,0.356808880446 ,0.297996444508 ,0.115545199894 ,0.451999788169 ,0.977931712032 ,0.467007414589 ,0.0324423432766 ,0.655808170458 ,0.0285536161788 ,0.301706859261 ,0.978096831437 ,0.0773522949678 ,0.344113940221 ,0.00221171017703 ,0.687384613096 ,0.0340227899445 ,0.276593395954 ,0.0180205508629 ,0.0912048481974 ,0.957712277396 ,0.888077711668 ,0.656974074218 ,0.979750923199 ,0.460713156142 ,0.0753490635974 ,0.804689221867 ,0.636746621904 ,0.704188399015 ,0.974231975407 ,0.655189397626 ,0.67981727546 ,0.33519948637 ,0.796416134945 ,0.308545088619 ,0.00240787489682 ,0.970657575512 ,0.270178493467 ,0.867849122053 ,0.485813731637 ,0.918774970041 ,0.607210080263 ,0.936744593487 ,0.390667563456 ,0.978420203596 ,0.833530655529 ,0.942860335083 ,0.948744888411 ,0.677608661547 ,0.365829193086 ,0.32427669133 ,0.165743435937 ,0.144629688963 ,0.00109044509007 ,0.100772319995 ,0.514637832698 ,0.969267690006 ,0.437910313702 ,0.403278106472 ,0.555051616701 ,0.449460236243 ,0.604541257441 ,0.480726051627 ,0.169517618329 ,0.218211099347 ,0.725118080566 ,0.0296022350479 ,0.626116768145 ,0.369086844024 ,0.621800250636 ,0.381800342683 ,0.499281988651 ,0.66698308214 ,0.766636546269 ,0.265950368931 ,0.767760525737 ,0.406158032758 ,0.0723423779677 ,0.187309066188 ,0.464948700863 ,0.746224654807 ,0.530054395485 ,0.213186161931 ,0.338449735983 ,0.495457174791 ,0.634729482323 ,0.25575593721 ,0.28428996233 ,0.695040972928 ,0.748244732292 ,0.0459120687217 ,0.49326128585 ,0.215754131484 ,0.430223713744 ,0.114603635783 ,0.421122499383 ,0.653970534446 ,0.247494707725 ,0.719336283716 ,0.342339190558 ,0.484888479698 ,0.406105743506 ,0.469840028706 ,0.949931626818 ,0.566786003947 ,0.0851376062327 ,0.82138086678 ,0.0843777051257 ,0.927930758342 ,0.0388269179308 ,0.1641051491 ,0.885842931996 ,0.165354822214 ,0.791406155194 ,0.466213616126 ,0.525771396999 ,0.538493960653 ,0.366791056531 ,0.104834189019 ,0.180722946055 ,0.737317534211 ,0.695924679095 ,0.725375803287 ,0.864989517219 ,0.767448594649 ,0.91236649772 ,0.157401468813 ,0.98316375254 ,0.568368649871 ,0.897847375194 ,0.053231122622 ,0.814490779469 ,0.598283519104 ,0.353431614942 ,0.2440017829 ,0.0246521769156 ,0.922096917604 ,0.243209568963 ,0.945242950416 ,0.870010311034 ,0.682792521321 ,0.916289928208 ,0.141221433566 ,0.0701948976961 ,0.0314100056413 ,0.274218655577 ,0.0294947166912 ,0.851114476952 ,0.546703489712 ,0.0802994615442 ,0.338958293251 ,0.836946038638 ,0.955550341505 ,0.845184925962 ,0.920297072732 ,0.713550065413 ,0.194808761808 ,0.497182690414 ,0.0925389030576 ,0.682920205076 ,0.040859721163 ,0.40301545224 ,0.086214913834 ,0.827229187322 ,0.504615487708 ,0.873799811906 ,0.647357690239 ,0.0368653805954 ,0.106261541976 ,0.441230467448 ,0.451160533834 ,0.532076101683 ,0.986492978144 ,0.847999505498 ,0.826685568562 ,0.765282953993 ,0.079980414006 ,0.0742647069652 ,0.997526229671 ,0.880212779024 ,0.526468591573 ,0.0220770233472 ,0.910177891402 ,0.2344056673 ,0.246639807692 ,0.91262962824 ,0.91124292657 ,0.0361387809472 ,0.643139881998 ,0.574069456506 ,0.499028251568 ,0.821844873232 ,0.488865653574 ,0.438734544109 ,0.98831911436 ,0.101125227957 ,0.986422682333 ,0.15690822897 ,0.66238781581 ,0.149868628701 ,0.408903696583 ,0.608771794067 ,0.364190905391 ,0.212590674892 ,0.965802174876 ,0.816619471508 ,0.277792078041 ,0.0189185487859 ,0.204645906327 ,0.0684007189857 ,0.794804153355 ,0.976697806748 ,0.471939060279 ,0.44648259731 ,0.595981101745 ,0.641776290642 ,0.827054158918 ,0.269289567974 ,0.110487833102 ,0.681797097963 ,0.4615898783 ,0.1384469839 ,0.843332614886 ,0.838567327604 ,0.778208753236 ,0.481837791726 ,0.0773271883583 ,0.0623435238032 ,0.952418421292 ,0.888668424277 ,0.630657013315 ,0.446991605941 ,0.102932129694 ,0.388719403046 ,0.989234751359 ,0.647680584912 ,0.970252177249 ,0.641420007678 ,0.0589270062077 ,0.393380272333 ,0.465370500702 ,0.951934078365 ,0.727282084264 ,0.201734785557 ,0.000971270693998 ,0.762638754994 ,0.167244905134 ,0.727816269435 ,0.78654374366 ,0.963166754423 ,0.97526314368 ,0.574515459018 ,0.0688817033578 ,0.744977425413 ,0.633888216827 ,0.151153571414 ,0.943988828271 ,0.109668070067 ,0.607557421529 ,0.476209095858 ,0.0103542975696 ,0.5683339708 ,0.0289325270636 ,0.093616890322 ,0.553334700685 ,0.53227071939 ,0.690416393457 ,0.835652241942 ,0.832039587427 ,0.366579752572 ,0.350187541337 ,0.809618463839 ,0.763894575226 ,0.401335483292 ,0.736307758043 ,0.833259503253 ,0.620780397007 ,0.59755101551 ,0.26791342851 ,0.814366807113 ,0.737933924281 ,0.465009473362 ,0.600092663909 ,0.0139518669451 ,0.884172020542 ,0.109379674291 ,0.940753240176 ,0.0291505429805 ,0.717798604627 ,0.771761747817 ,0.38867026044 ,0.457131193831 ,0.527692769121 ,0.466973536766 ,0.152247445675 ,0.831444846618 ,0.882890185495 ,0.932434566484 ,0.824194775749 ,0.935204187123 ,0.550282307818 ,0.693474783823 ,0.531497617843 ,0.0890915580958 ,0.249489975049 ,0.336989218883 ,0.662596761034 ,0.795998781004 ,0.9104449589 ,0.613480301225 ,0.512125151222 ,0.872238598824 ,0.967474116947 ,0.870424673353 ,0.370100954153 ,0.516651066712 ,0.191915609022 ,0.389357763768 ,0.705089771864 ,0.777022246979 ,0.287670044295 ,0.025776497358 ,0.330531219859 ,0.283784699616 ,0.0770472379373 ,0.152795391832 ,0.38742967965 ,0.382478532303 ,0.792525059897 ,0.351146212008 ,0.333836296635 ,0.242692766494 ,0.356359377997 ,0.655005104443 ,0.425988292937 ,0.330359453491 ,0.0718746230803 ,0.0338027755984 ,0.4649941112 ,0.315118376898 ,0.0118192306067 ,0.825031352731 ,0.59875591938 ,0.663800517174 ,0.378689833136 ,0.598981620549 ,0.44390095308 ,0.411579302503 ,0.365465073453 ,0.2267253622 ,0.434884205539 ,0.840285353421 ,0.212925778856 ,0.929512029111 ,0.938147892797 ,0.329917657365 ,0.896812040503 ,0.804043954853 ,0.349300485613 ,0.681779252342 ,0.531847934782 ,0.17753668749 ,0.174534909612 ,0.507290535345 ,0.281692375985 ,0.925957419515 ,0.171696281054 ,0.187316116837 ,0.808436621067 ,0.966329972783 ,0.160615476357 ,0.0709235219986 ,0.700793671589 ,0.637176254068 ,0.572175627732 ,0.808149371856 ,0.40562156251 ,0.663486602433 ,0.817386371867 ,0.496912042307 ,0.0848594390142 ,0.058597682011 ,0.0620212438023 ,0.910916288655 ,0.712054732192 ,0.632432134371 ,0.517298559041 ,0.212315673723 ,0.627701591929 ,0.260341997516 ,0.526252436448 ,0.688737825251 ,0.955676004658 ,0.419230021925 ,0.790308474798 ,0.38211828517 ,0.272731968363 ,0.26771971208 ,0.625129033838 ,0.548127570415 ,0.0928421011846 ,0.486864226362 ,0.881774940196 ,0.833248112147 ,0.469652600518 ,0.141187729167 ,0.52832187456 ,0.719398069734 ,0.750579712524 ,0.411536545144 ,0.888742437051 ,0.890215099795 ,0.436477449094 ,0.00225950804051 ,0.218901178533 ,0.109549596721 ,0.956186768682 ,0.659756443267 ,0.670372241928 ,0.873344047417 ,0.349277677799 ,0.272752236201 ,0.137722780018 ,0.776668765249 ,0.417457168139 ,0.814600945493 ,0.898284196549 ,0.96816485982 ,0.133795188501 ,0.861212498467 ,0.919201811757 ,0.994611529225 ,0.655040926002 ,0.647006247624 ,0.134616337561 ,0.416595259185 ,0.525304524736 ,0.173653423606 ,0.762248897056 ,0.0361421991248 ,0.218272204346 ,0.723548700256 ,0.174943183952 ,0.756765290109 ,0.968516766001 ,0.600247368696 ,0.673891767034 ,0.189637663423 ,0.816997964764 ,0.789274642114 ,0.310768132275 ,0.827575455221 ,0.696986655631 ,0.457861404991 ,0.216091457499 ,0.668103268794 ,0.412369236284 ,0.762425677047 ,0.000750446482944 ,0.837594738608 ,0.8721092927 ,0.567205558315 ,0.772602045459 ,0.353702810883 ,0.408563102456 ,0.645314033834 ,0.0998383290852 ,0.594161923773 ,0.53856845403 ,0.548347644647 ,0.174790383231 ,0.48296008436 ,0.105880960463 ,0.758079310787 ,0.800884069438 ,0.142238493405 ,0.779231690312 ,0.663785715003 ,0.461321612978 ,0.617341484862 ,0.740907764168 ,0.447632419669 ,0.466884542486 ,0.00128766762001 ,0.231096522832 ,0.586280517714 ,0.796787461738 ,0.995153362159 ,0.822969000606 ,0.427069893141 ,0.75617460311 ,0.387210889879 ,0.838563441283 ,0.0235290519684 ,0.444983787107 ,0.0516886834862 ,0.230826653035 ,0.36452791424 ,0.147785239818 ,0.771370367968 ,0.70489713042 ,0.525382185335 ,0.0201237380026 ,0.958035792548 ,0.159082401547 ,0.240045145997 ,0.278616041441 ,0.879126566274 ,0.157956040444 ,0.688912678243 ,0.66850782059 ,0.14923828093 ,0.585034505391 ,0.547787902728 ,0.244463647767 ,0.85707732069 ,0.394255008146 ,0.758307264773 ,0.783295417803 ,0.305969486346 ,0.116171147519 ,0.982937714762 ,0.379368309835 ,0.597354114911 ,0.0993640418229 ,0.703932362889 ,0.23522699926 ,0.00347668566294 ,0.208123006646 ,0.714955041756 ,0.602914718475 ,0.6893125964 ,0.763239846047 ,0.746583591841 ,0.372004713009 ,0.290568723971 ,0.172775670312 ,0.0559359343608 ,0.927822933178 ,0.127486555844 ,0.778926948747 ,0.155534347175 ,0.215648567575 ,0.502328527068 ,0.647910835323 ,0.390491105732 ,0.811289526728 ,0.785319518817 ,0.527280969005 ,0.181497974573 ,0.154336867955 ,0.29914585556 ,0.778149737473 ,0.817139649158 ,0.355429773383 ,0.0485044216678 ,0.847875492583 ,0.0282400500916 ,0.869136310265 ,0.290269317479 ,0.421220355537 ,0.569205195047 ,0.978925028505 ,0.796595546302 ,0.0930114946538 ,0.610754305359 ,0.00586130415819 ,0.191699587296 ,0.390603808028 ,0.734137030923 ,0.396166496445 ,0.463240764042 ,0.648925456312 ,0.266755663785 ,0.139509122652 ,0.803515998899 ,0.670967891941 ,0.782356428673 ,0.800903928207 ,0.463778750449 ,0.871670874167 ,0.720939958191 ,0.239372426843 ,0.950346042784 ,0.695719108805 ,0.649001820052 ,0.771784846338 ,0.609156395592 ,0.372661072734 ,0.823929888723 ,0.391834706329 ,0.0462568292674 ,0.155343962742 ,0.481706779381 ,0.869162090755 ,0.14208446013 ,0.577012069068 ,0.631609001424 ,0.359347602221 ,0.852072551646 ,0.78079915417 ,0.486325979885 ,0.417684498341 ,0.721107327656 ,0.687454764952 ,0.909729664188 ,0.291401437214 ,0.543503344361 ,0.300998974586 ,0.636498860927 ,0.959698037146 ,0.670672659439 ,0.606654972574 ,0.917060945158 ,0.763275683574 ,0.973668106512 ,0.206799816176 ,0.500245707203 ,0.27197313076 ,0.87761848877 ,0.00765819679477 ,0.802475413443 ,0.605144156668 ,0.876137513634 ,0.775531992652 ,0.636271833456 ,0.618500831252 ,0.828460901973 ,0.326366804561 ,0.102929970723 ,0.243970345161 ,0.00383684712636 ,0.919235975114 ,0.847430228597 ,0.944474225948 ,0.578620906219 ,0.56935461317 ,0.502176302293 ,0.431161327324 ,0.837526654508 ,0.0853687169587 ,0.906131301172 ,0.0193126724075 ,0.558613504964 ,0.669423729512 ,0.7617149571 ,0.0592688941851 ,0.184917986114 ,0.468830491691 ,0.12442061423 ,0.333566078778 ,0.400318601784 ,0.388009590426 ,0.49051372379 ,0.622528084539 ,0.81091931938 ,0.426650585942 ,0.218273961658 ,0.28254857101 ,0.190626504013 ,0.0370843766659 ,0.215766766395 ,0.461455179139 ,0.277573275419 ,0.393757408217 ,0.0107390383714 ,0.189005374252 ,0.954989027279 ,0.429616410908 ,0.707088427209 ,0.891119393066 ,0.119490577442 ,0.0445372179349 ,0.379237482015 ,0.440228799796 ,0.818775361196 ,0.815856024037 ,0.863001524143 ,0.300834667836 ,0.712388036707 ,0.362195772017 ,0.46692384162 ,0.555419847138 ,0.900357736961 ,0.247881154753 ,0.536052682321 ,0.294064568191 ,0.338612253003 ,0.850345338871 ,0.608236992093 ,0.357839219844 ,0.933028827599 ,0.708748162846 ,0.708188282049 ,0.573994729213 ,0.408790079755 ,0.324642161965 ,0.225956443418 ,0.00389335331659 ,0.145820083309 ,0.653686469336 ,0.30162071521 ,0.862445752997 ,0.357326331505 ,0.152318927169 ,0.0555525905684 ,0.677946301573 ,0.747942123097 ,0.335138396441 ,0.000205276252355 ,0.308604759859 ,0.513893925389 ,0.542461657916 ,0.148187261964 ,0.380393084905 ,0.913196472369 ,0.457400169635 ,0.915726021376 ,0.450046336169 ,0.825960286035 ,0.166999882529 ,0.248137459731 ,0.573439385659 ,0.177284523187 ,0.560232204413 ,0.670299475334 ,0.748797215714 ,0.323511726755 ,0.382178940398 ,0.580654028498 ,0.817126925601 ,0.0688308085685 ,0.820435420708 ,0.159566042384 ,0.614967758904 ,0.214464812282 ,0.802908126567 ,0.759363998845 ,0.471318849716 ,0.784175459561 ,0.482718597216 ,0.196532462677 ,0.217982411436 ,0.0639200848573 ,0.689226717007 ,0.905862151603 ,0.445830127605 ,0.935919753277 ,0.252495649687 ,0.902483896156 ,0.61899323234 ,0.627832974566 ,0.92947679155 ,0.430635677458 ,0.594153830891 ,0.682521814747 ,0.582150273645 ,0.521830460573 ,0.474670835893 ,0.0759297358388 ,0.23419668594 ,0.961742757777 ,0.540083797064 ,0.515883894497 ,0.506710835813 ,0.305453200873 ,0.177492803216 ,0.998897876049 ,0.816829155228 ,0.77075438694 ,0.583976073597 ,0.0727524385021 ,0.220272232743 ,0.00797864987081 ,0.912840980418 ,0.837586534612 ,0.323420425765 ,0.106504626617 ,0.565801626034 ,0.716959441383 ,0.578798120247 ,0.331707135693 ,0.964509838816 ,0.343017751502 ,0.950345851065 ,0.121453785522 ,0.651175169536 ,0.375007773118 ,0.281471436459 ,0.697644495316 ,0.236436722946 ,0.276950016361 ,0.0935991229802 ,0.488345884109 ,0.658864758339 ,0.691640337472 ,0.739194950604 ,0.724487028155 ,0.323696787137 ,0.00662118077301 ,0.512748610278 ,0.666428231676 ,0.450946698275 ,0.542095002021 ,0.41817161982 ,0.469699663498 ,0.877156298429 ,0.424577127065 ,0.0521572902758 ,0.0197045788523 ,0.0984474495446 ,0.725884203036 ,0.646091253497 ,0.660597785012 ,0.0946281457628 ,0.601440962668 ,0.305330216214 ,0.0180488767543 ,0.0497042821657 ,0.594756286081 ,0.643064272599 ,0.585983175566 ,0.710483352807 ,0.680053053977 ,0.591243086479 ,0.0207265654745 ,0.880495080533 ,0.714204326771 ,0.588044723011 ,0.763555820335 ,0.0630449266752 ,0.777628038245 ,0.167115828756 ,0.821024518434 ,0.0768396539761 ,0.0231012283658 ,0.882849902462 ,0.388704837354 ,0.95982328649 ,0.647907955202 ,0.897946692543 ,0.837953769143 ,0.940053745746 ,0.665852783406 ,0.492124673027 ,0.687742157631 ,0.58795613786 ,0.732619225885 ,0.838012596084 ,0.40920487072 ,0.530467473766 ,0.482038124535 ,0.0322590330078 ,0.357598368265 ,0.481210921075 ,0.83203288762 ,0.440792573032 ,0.739958952394 ,0.957615204622 ,0.860539457345 ,0.883574923705 ,0.286076138204 ,0.21994594223 ,0.317233360467 ,0.170600561641 ,0.856783700326 ,0.788178327209 ,0.673948803316 ,0.410646207194 ,0.457570311302 ,0.0398932603726 ,0.404405574509 ,0.741497875621 ,0.794749860574 ,0.346984997869 ,0.899294109477 ,0.0228568095503 ,0.852156555636 ,0.505026152379 ,0.690443291528 ,0.604319940863 ,0.935983694641 ,0.06278942041 ,0.983698722413 ,0.106850587355];
    bins = [0 (cumsum(p2)/sum(sum(p2)))'];
    [h, edg] = histcounts(r,bins);
    ind = reshape(h>=1, 1, numel(h));
    hn0=nonzeros(h);
    cnt = reshape(hn0, numel(hn0),1);
    %size(cnt)
    %size(ind)
end